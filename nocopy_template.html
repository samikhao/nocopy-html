<!-- nocopy-protect start -->
<style id="nocopy-style">
	* {
		-webkit-user-select: none !important; /* Safari/Chrome/iOS */
		-moz-user-select: none !important; /* Firefox */
		-ms-user-select: none !important; /* old Edge/IE */
		user-select: none !important; /* standard */
	}
	@media print {
		/* styles for printer */
		* {
			-webkit-user-select: text !important;
			-moz-user-select: text !important;
			-ms-user-select: text !important;
			user-select: text !important;
		}
	}
</style>
<div
	id="nocopy-mini"
	style="
		position: fixed;
		top: 12px;
		right: 12px;
		z-index: 2147483647;
		font: 14px system-ui, sans-serif;
		background: #fff;
		border: 1px solid #ddd;
		border-radius: 8px;
		padding: 6px 8px;
		box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
	"
>
	<span id="nocopy-label">Copy protection enabled</span>
	<button id="nocopy-btn" style="margin-left: 8px; cursor: pointer">
		Disable
	</button>
</div>
<script>
	;(() => {
		const cfg = { salt_b64: '__SALT__', hash_b64: '__HASH__', iter: __ITER__ }
		const b64 = s => Uint8Array.from(atob(s), c => c.charCodeAt(0))
		const eq = (a, b) => a.length === b.length && a.every((v, i) => v === b[i])
		const te = new TextEncoder()

		async function ok(pwd) {
			const key = await crypto.subtle.importKey(
				'raw',
				te.encode(pwd),
				'PBKDF2',
				false,
				['deriveBits']
			)
			const bits = await crypto.subtle.deriveBits(
				{
					name: 'PBKDF2',
					hash: 'SHA-256',
					salt: b64(cfg.salt_b64),
					iterations: cfg.iter,
				},
				key,
				256
			)
			return eq(new Uint8Array(bits), b64(cfg.hash_b64))
		}

		async function unlock() {
			const label = document.getElementById('nocopy-label')
			const btn = document.getElementById('nocopy-btn')
			const box = document.getElementById('nocopy-mini')

			const pwd = prompt('Enter password:')
			if (pwd == null) return
			if (await ok(pwd)) {
				document.getElementById('nocopy-style')?.remove()
				box.style.background = '#d4f8d4'
				label.textContent = 'Copy protection disabled until page reload'
				btn.remove()
			} else {
				box.style.background = '#ffd6d6'
				label.textContent = 'Wrong password âœ—'
			}
		}

		document.addEventListener(
			'click',
			e => {
				if (e.target && e.target.id === 'nocopy-btn') unlock()
			},
			{ capture: true }
		)
	})()
</script>
<!-- nocopy-protect end -->
